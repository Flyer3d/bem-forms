# form blocks draft

## Common API

### form extends BEMDOM

#### Methods
- `{Object} getVal()`
- `{Array.<FormTuple>} getFields()`
- `{BEMDOM} setVal({Object} val)`
- `{BEMDOM} onSubmit({Function} fn)`

### form__tuple extends BEM

Интерфейс для примитива поля/контрола формы.

### Methods
- `{String} getName()`
- `{*} getVal()`
- `{BEMDOM} setVal({*} val)`

### label

Блок метка, привязывается к form__control или input, attach, textarea, etc.

### form__control

Контрол, содержит в себе ровно один элемент ввода (типа input, attach, textarea, etc.)

Может использоваться только с каким-то типом

### form__control_type_X

Контрол типа X, где X, по умолчанию, это один из базовых input, attach, textarea, etc.



## Validation API

### validation

Блок с валидациями. Крепится к инстансам form__tuple (полю или контролу), а так же может напрямую использоваться с input, attach, textarea, etc.

? Или к чему угодно, где есть пользовательский ввод — пока не до конца понятно про все инпуты/контролы/аттачи.

#### Methods

?

### form_with-validity

Расширение формы валидацией, зависит от блока [validate].

#### Methods
- `{BEM} onSubmit()` - перегрузка сабмита, приостанавливается до положительного разрешения промиса из `checkValidity()`
- `{Promise} checkValidity()` - Таки промис или не промис? Ведь капчу тоже хочется проверять, как же без капчи?

#### Mods
- form_state_processing (validating?) — выставляется после вызова checkValidity, и стоит до разрешения промиса;
- form_state_valid — состояние формы, когда каждое из полей прошло проверку, либо вовсе их не требует;
- form_state_invalid — состояние формы, когда есть поля, которые требует проверки, и любое из них её не прошло;

### message

Сообщение об ошибке, по умолчанию скрыто, но его надо рисовать на морде, привязывается к form/form__field/form__control, в него можно складывать ошибку валидации, прячется если пользователь начал ввод, показывается при проверке поля/контрола/формы

### validation_required

Проверяет наличие значения в поле

### validation_numbers

Валидатор для чисел. Убеждается, что значение в поле это некоторое число.

Возможно передать точность числа, кол-во десятичных цифр, и т.д. в поле js.

#### Mods

- validation_numbers_money — проверяет, что поле конкретно бабло

### validation_pattern

Проверяет, что значение соответствует некоторому выражению.

Требует передачи этого выражения в поле js.

### validation_X

Любые другие валидаторы, в т.ч. пользовательские, которые можно кастомизировать с помощью поля js.



## Fields (draft)

### form_fielded

- Натравливает форму на использование `form__field` (`browser.js`);
- Генерирует кишки полей в шаблонах, в т.ч. навешивает валидации;

#### Methods
- `{Array.<FormField>} getFields()`
- `{Object} getVal()`
- `{BEMDOM} setVal({Object} val)`

### Элемент form__field

Базовый функционал элемента формы.

Может включать в себя {0..n} контролов, комбинировать их вывод, инициализировать ввод, делать пре/пост процессинг данных из контролов, аггрегировать данные из других полей формы, и т.д. Все решается в контретных реализациях.

### Модификации form__field_type_X

Поле типа X, которые пользователь определяет и переопределяет на уровнях проекта и бандла.

Позволяет конкретизировать внутреннюю логику поля формы, включая валидацию, возвращаемое значение, и т.д.

#### Примеры

##### _type_price
Cостоит из формы ввода для суммы и селектора валют, в особо тяжелых случаях может еще отображать введенную сумму в рублях при пересчете по курсу ЦБ.
Пример значения: `{currency: 'euro', amount: '152.12'}`.

##### _type_coord
Состоит из 2х скрытых форм ввода (`input type=hidden`) и гео-карты, с помощью которой позволяет выбирать произвольную гео-точку.
Пример значения: `{lat : 55.4507, long : 37.3656}`.

##### _type_nested-leafs
Позволяет выбирать любое кол-во конечных элементов (листьев) в произвольной заранее известной древовидной структуре. Имеет логику отрисовки подветок на клиенте, и т.д.
Пример значения: `[4, 2, 42]`

##### _type_tags
Позволяет выбирать теги из облака.
Пример значения: `['bem', 'rocks']`
